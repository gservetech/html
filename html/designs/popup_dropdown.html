<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Two Popups (Popover + Anchor Positioning) - Mobile Safe v2</title>
    <style>
      :root {
        color-scheme: light dark;
        --border: color-mix(in oklab, CanvasText 18%, transparent);
        --card: color-mix(in oklab, Canvas 92%, CanvasText);
        --shadow: 0 10px 30px color-mix(in oklab, black 30%, transparent);
        --r: 14px;
        --muted: color-mix(in oklab, CanvasText 70%, transparent);
      }

      body {
        margin: 0;
        font-family:
          system-ui,
          -apple-system,
          sans-serif;
        min-height: 100svh;
        display: grid;
        place-items: center;
        background: Canvas;
        color: CanvasText;
        padding: 18px;
      }

      .wrap {
        width: min(900px, 92vw);
        padding: 22px;
        border: 1px solid var(--border);
        border-radius: calc(var(--r) + 6px);
        background: color-mix(in oklab, var(--card) 85%, transparent);
      }

      .row {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        align-items: center;
      }

      .btn {
        border: 1px solid var(--border);
        background: color-mix(in oklab, var(--card) 80%, transparent);
        color: inherit;
        padding: 10px 14px;
        border-radius: 999px;
        cursor: pointer;
        font-weight: 650;
      }

      .pop {
        margin: 0;
        border: 1px solid var(--border);
        border-radius: var(--r);
        background: var(--card);
        box-shadow: var(--shadow);
        padding: 12px;
        width: min(340px, 86vw);
        max-height: min(70svh, 520px);
        overflow: auto;
      }

      /* Desktop Anchor Logic */
      @supports (anchor-name: --a) {
        #btnA {
          anchor-name: --btnA;
        }
        #popA {
          position: absolute;
          position-anchor: --btnA;
          position-area: bottom left;
          margin-top: 8px;
        }
        #btnB {
          anchor-name: --btnB;
        }
        #popB {
          position: absolute;
          position-anchor: --btnB;
          position-area: bottom left;
          margin-top: 8px;
        }
      }

      /* ✅ MOBILE FIX: Force bottom sheet behavior */
      @media (max-width: 640px) {
        .pop:popover-open {
          /* Reset all anchor/positioning logic */
          position: fixed !important;
          inset: auto 0 0 0 !important; /* Bottom of screen */

          /* Center it with width and margin */
          width: 92vw !important;
          max-width: none !important;
          margin: 0 auto 18px auto !important; /* Center horizontally, gap at bottom */

          /* Visual adjustments */
          border-radius: 20px;
          animation: slide-up 0.3s cubic-bezier(0, 0, 0.2, 1);
        }

        @keyframes slide-up {
          from {
            transform: translateY(100%);
          }
          to {
            transform: translateY(0);
          }
        }
      }

      /* Shared Menu Styles */
      .pop-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 10px;
      }
      .menu-title {
        font-weight: 800;
      }
      .close {
        border: 1px solid var(--border);
        background: none;
        color: inherit;
        border-radius: 999px;
        padding: 4px 8px;
        cursor: pointer;
      }
      .menu {
        display: grid;
        gap: 8px;
      }
      .menu a {
        text-decoration: none;
        color: inherit;
        padding: 10px;
        border-radius: 10px;
        border: 1px solid var(--border);
        background: color-mix(in oklab, var(--card) 75%, transparent);
      }
    </style>
  </head>

  <body>
    <div class="wrap">
      <div class="row">
        <button
          id="btnA"
          class="btn"
          popovertarget="popA"
          popovertargetaction="toggle"
        >
          Popup A ▾
        </button>

        <button
          id="btnB"
          class="btn"
          popovertarget="popB"
          popovertargetaction="toggle"
        >
          Popup B ▾
        </button>
      </div>

      <p class="hint">
        Mobile mode forces both popups into a bottom-sheet so nothing hides.
        Desktop uses anchor positioning when supported.
      </p>

      <div
        id="popA"
        class="pop"
        popover="auto"
        role="dialog"
        aria-label="Popup A"
      >
        <div class="pop-header">
          <div class="menu-title">Popup A Menu</div>
          <button
            class="close"
            popovertarget="popA"
            popovertargetaction="hide"
            aria-label="Close Popup A"
          >
            ✕
          </button>
        </div>
        <nav class="menu" aria-label="Popup A options">
          <a href="#">View profile</a>
          <a href="#">Account settings</a>
          <a href="#">My orders</a>
          <a href="#">Sign out</a>
          <a href="#">Help</a>
          <a href="#">Support</a>
        </nav>
      </div>

      <div
        id="popB"
        class="pop"
        popover="auto"
        role="dialog"
        aria-label="Popup B"
      >
        <div class="pop-header">
          <div class="menu-title">Popup B Menu</div>
          <button
            class="close"
            popovertarget="popB"
            popovertargetaction="hide"
            aria-label="Close Popup B"
          >
            ✕
          </button>
        </div>
        <nav class="menu" aria-label="Popup B options">
          <a href="#">Create new</a>
          <a href="#">Upload file</a>
          <a href="#">Manage items</a>
          <a href="#">Share</a>
          <a href="#">Delete</a>
        </nav>
      </div>
    </div>
  </body>
</html>
